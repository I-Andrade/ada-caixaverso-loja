<div
  *ngIf="open"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"
>
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-xl">
    <h2 class="text-xl font-bold mb-4">
      {{ isEdit ? "Editar Produto" : "Adicionar Produto" }}
    </h2>
    <form [formGroup]="form" (ngSubmit)="submit()" class="flex flex-col gap-4">
      <mat-form-field>
        <mat-label>Título</mat-label>
        <input matInput formControlName="title" required />
        @if (form.get('title')?.hasError('required') &&
        form.get('title')?.touched) {
        <mat-error>O título é obrigatório.</mat-error>
        }
      </mat-form-field>
      <mat-form-field>
        <mat-label>Preço (R$)</mat-label>
        <input matInput type="number" formControlName="price" required />
        @if (form.get('price')?.hasError('required') &&
        form.get('price')?.touched) {
        <mat-error>O preço é obrigatório.</mat-error>
        } @if (form.get('price')?.hasError('min') && form.get('price')?.touched)
        {
        <mat-error>O preço deve ser maior do que R$ 0.00.</mat-error>
        }
      </mat-form-field>
      <mat-form-field>
        <mat-label>Descrição</mat-label>
        <textarea matInput formControlName="description"></textarea>
      </mat-form-field>
      <div class="flex mb-2 items-start justify-between">
        <mat-form-field class="flex-1">
          <mat-label>Imagem (URL)</mat-label>
          <input matInput formControlName="image" />
        </mat-form-field>
        @if (isImageValid) {
        <div
          class="ml-4 flex flex-col items-center"
          (mouseenter)="showImagePreview = true"
          (mouseleave)="showImagePreview = false"
        >
          <img
            [src]="form.get('image')?.value"
            alt="Preview da imagem"
            class="image-thumb object-cover rounded border border-gray-200 cursor-pointer"
            style="width: 48px; height: 48px"
          />
          <span class="text-xs text-gray-500">Miniatura</span>
          @if (showImagePreview) {
          <div
            class="image-preview-panel"
            style="
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              z-index: 9999;
            "
          >
            <img
              [src]="form.get('image')?.value"
              alt="Preview grande"
              style="
                max-width: 320px;
                max-height: 320px;
                border-radius: 8px;
                box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
                background: white;
              "
            />
          </div>
          }
        </div>
        }
      </div>
      <mat-form-field>
        <mat-label>Categoria</mat-label>
        <input matInput formControlName="category" />
      </mat-form-field>
      <div class="flex gap-2 justify-end mt-4">
        <button mat-button type="button" (click)="cancel()">Cancelar</button>
        <button
          mat-raised-button
          [color]="form.valid ? 'primary' : 'warn'"
          type="submit"
          matTooltip="{{
            form.valid
              ? isEdit
                ? 'Salvar produto'
                : 'Adicionar produto'
              : 'Preencha todos os campos obrigatórios para salvar'
          }}"
          [ngClass]="form.valid ? 'cursor-pointer' : 'cursor-not-allowed'"
        >
          {{ isEdit ? "Salvar" : "Adicionar" }}
        </button>
      </div>
    </form>
  </div>
</div>
